<!-- src/plugins/customer-picker/ui/components/customer-picker-modal/customer-picker-modal.component.html -->
<div class="modal-backdrop" *ngIf="visible" (click)="close.emit()"></div>
<div class="modal modal-dialog modal-lg" *ngIf="visible" tabindex="0">
	<div class="modal-header">
		<div class="modal-title">Choisir ou créer un client</div>
	</div>
	<div class="modal-body">
		<div class="search">
			<input
					type="text"
					[formControl]="searchTerm"
					placeholder="Rechercher par email ou nom (3+ caractères)…"
			/>
			<button
					class="clear-btn"
					*ngIf="searchTerm.value"
					(click)="searchTerm.reset()"
			>✕</button>
		</div>
		<div class="spinner" *ngIf="loading"></div>
		<table class="customer-table" *ngIf="!loading">
			<thead>
			<tr>
				<th colspan="3">
					<form
							*ngIf="showNewForm"
							[formGroup]="newCustomerForm"
							(ngSubmit)="onCreateCustomer()"
							class="new-customer-form"
					>
						<div class="form-row">
							<input formControlName="firstName" placeholder="Prénom" required />
							<input formControlName="lastName" placeholder="Nom" required />
							<input formControlName="emailAddress" placeholder="Email" type="email" required />
						</div>
						<div class="form-actions">
							<button type="submit" [disabled]="newCustomerForm.invalid || loading">
								{{ loading ? 'Création…' : 'Créer' }}
							</button>
							<button type="button" (click)="cancelNew()">Masquer</button>
						</div>
					</form>
				</th>
			</tr>

			</thead>
			<tbody>

			<tr
					*ngFor="let c of customers; let i = index"
					(click)="selectCustomer(c)"
					[class.selected]="c.id === selectedCustomerId"
					[class.focused]="i === focusedIndex"
			>

				<td>{{ c.firstName }}</td>
				<td>{{ c.lastName }}</td>
				<td>{{ c.emailAddress }}</td>
			</tr>
			<tr >
				<td colspan="3">
					<div *ngIf="!loading && customers.length === 0 ">
						Aucun client trouvé.
					</div>

				</td>
			</tr>
			</tbody>
		</table>
		<div class="pagination" *ngIf="!loading && totalPages > 1">
			<button (click)="goTo(1)" [disabled]="currentPage === 1">« First</button>
			<button (click)="prevPage()">‹ Prev</button>
			<label>
				Taille :
				<select [value]="pageSize" (change)="changePageSize($any($event.target).value)">
					<option *ngFor="let s of [10,25,50]" [value]="s">{{ s }}</option>
				</select>
			</label>
			<span>Page {{ currentPage }} / {{ totalPages }}</span>
			<button (click)="nextPage()">Next ›</button>
			<button (click)="goTo(totalPages)" [disabled]="currentPage === totalPages">
				Last »
			</button>
		</div>
	</div>

	<div class="modal-footer">

		<div class="clr-row">
			<button class="btn-create" (click)="showNewForm = true">➕ Nouveau client</button>
			<button class="btn btn-danger close-btn" (click)="close.emit()">Fermer</button>
		</div>

	</div>
</div>
